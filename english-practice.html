<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>7th Grade English Practice | ×ª×¨×’×•×œ ×× ×’×œ×™×ª ×›×™×ª×” ×–×³</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* â”€â”€ RESET & VARS â”€â”€ */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary:   #0EA5E9;
      --secondary: #22D3EE;
      --success:   #10B981;
      --danger:    #F43F5E;
      --warning:   #F59E0B;
      --dark:      #0F172A;
      --text:      #1E293B;
      --muted:     #64748B;
      --card:      rgba(240,249,255,0.98);
      --radius:    22px;
      --shadow:    0 24px 64px rgba(14,165,233,0.18);
    }

    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      color: var(--text);
      background: linear-gradient(-45deg, #0F172A, #0C4A6E, #0E7490, #164E63, #083344);
      background-size: 500% 500%;
      animation: bgAnim 14s ease infinite;
      overflow-x: hidden;
    }

    /* Animated background blobs */
    body::before, body::after {
      content: '';
      position: fixed;
      border-radius: 50%;
      background: rgba(255,255,255,0.08);
      animation: blob 10s ease-in-out infinite;
      z-index: 0;
      pointer-events: none;
    }
    body::before { width: 500px; height: 500px; top: -150px; left: -150px; }
    body::after  { width: 380px; height: 380px; bottom: -120px; right: -120px; animation-delay: -5s; }

    @keyframes bgAnim {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes blob {
      0%, 100% { transform: scale(1) translate(0, 0); }
      33%  { transform: scale(1.1) translate(20px, -20px); }
      66%  { transform: scale(0.9) translate(-10px, 15px); }
    }

    /* â”€â”€ NAV â”€â”€ */
    nav {
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border-bottom: 1px solid rgba(255,255,255,0.18);
      padding: 13px 20px;
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      z-index: 200;
    }
    .nav-btn {
      background: rgba(255,255,255,0.18);
      border: 1.5px solid rgba(255,255,255,0.35);
      color: white;
      padding: 8px 18px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
      transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
      letter-spacing: 0.2px;
    }
    .nav-btn:hover {
      background: white;
      color: var(--primary);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
    }

    /* â”€â”€ LAYOUT â”€â”€ */
    .container {
      max-width: 680px;
      margin: 32px auto;
      padding: 0 16px;
      position: relative;
      z-index: 1;
    }

    /* â”€â”€ CARD â”€â”€ */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 36px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--warning));
      border-radius: var(--radius) var(--radius) 0 0;
    }

    /* Card entrance */
    .card-anim { animation: fadeSlideUp 0.45s cubic-bezier(0.22,1,0.36,1) both; }
    @keyframes fadeSlideUp {
      from { opacity: 0; transform: translateY(32px) scale(0.97); }
      to   { opacity: 1; transform: translateY(0)    scale(1); }
    }

    .hidden { display: none !important; }

    /* â”€â”€ SECTION HEADER â”€â”€ */
    .section-header { text-align: center; margin-bottom: 24px; }
    .section-header h1 {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .heb { direction: rtl; color: var(--muted); font-size: 15px; margin-top: 5px; font-weight: 400; }

    /* â”€â”€ PROGRESS â”€â”€ */
    .prog-bar {
      background: #f0f0f8;
      border-radius: 50px;
      height: 10px;
      overflow: hidden;
      margin: 14px 0 6px;
    }
    .prog-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 50px;
      transition: width 0.55s cubic-bezier(0.4,0,0.2,1);
      box-shadow: 0 0 8px rgba(14,165,233,0.5);
    }
    .prog-text {
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
      margin-bottom: 20px;
      letter-spacing: 0.3px;
    }

    /* â”€â”€ QUESTION WORD â”€â”€ */
    .q-word {
      text-align: center;
      font-size: 38px;
      font-weight: 700;
      color: var(--primary);
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border-radius: 16px;
      padding: 22px;
      margin: 16px 0;
      border: 2px solid rgba(14,165,233,0.12);
      letter-spacing: 0.5px;
    }
    .q-word.anim { animation: wordPop 0.4s cubic-bezier(0.34,1.56,0.64,1) both; }
    @keyframes wordPop {
      from { opacity: 0; transform: scale(0.82) translateY(8px); }
      to   { opacity: 1; transform: scale(1)    translateY(0); }
    }

    .q-instruction { text-align: center; font-size: 15px; color: var(--muted); font-weight: 500; margin-bottom: 14px; }

    /* â”€â”€ INPUT â”€â”€ */
    .ans-input {
      width: 100%;
      padding: 17px 22px;
      font-size: 19px;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      border: 2px solid #eaeaf8;
      border-radius: 14px;
      outline: none;
      transition: all 0.25s;
      background: #fafafe;
      color: var(--text);
    }
    .ans-input:focus {
      border-color: var(--primary);
      background: white;
      box-shadow: 0 0 0 5px rgba(14,165,233,0.1);
      transform: scale(1.01);
    }

    /* â”€â”€ BUTTONS â”€â”€ */
    .btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
      margin-top: 12px;
      letter-spacing: 0.3px;
      position: relative;
      overflow: hidden;
    }
    .btn:active { transform: scale(0.96) !important; }
    .btn-blue   { background: linear-gradient(135deg, #0EA5E9, #38BDF8); color: white; box-shadow: 0 8px 24px rgba(14,165,233,0.38); }
    .btn-green  { background: linear-gradient(135deg, #10B981, #34D399); color: white; box-shadow: 0 8px 24px rgba(16,185,129,0.38); }
    .btn-gray   { background: linear-gradient(135deg, #8e8ea8, #aaaacc); color: white; }
    .btn-yellow { background: linear-gradient(135deg, #FFA502, #ffcc02); color: white; box-shadow: 0 8px 24px rgba(255,165,2,0.35); }
    .btn:hover  { transform: translateY(-3px); filter: brightness(1.06); }

    /* Ripple on btn click */
    .btn .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: scale(0);
      animation: ripple 0.5s linear;
      pointer-events: none;
    }
    @keyframes ripple {
      to { transform: scale(4); opacity: 0; }
    }

    /* â”€â”€ OPTION BUTTONS â”€â”€ */
    .opt-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
    .opt-btn {
      padding: 16px 12px;
      border: 2px solid #eaeaf8;
      border-radius: 14px;
      background: white;
      cursor: pointer;
      font-size: 15px;
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
      transition: all 0.22s cubic-bezier(0.34,1.56,0.64,1);
      text-align: center;
      color: var(--text);
    }
    .opt-btn:hover:not(:disabled) {
      border-color: var(--primary);
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 20px rgba(14,165,233,0.18);
    }
    .opt-btn.correct {
      border-color: var(--success);
      background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      color: #059669;
      font-weight: 700;
      animation: bounceUp 0.45s cubic-bezier(0.34,1.56,0.64,1);
    }
    .opt-btn.wrong {
      border-color: var(--danger);
      background: linear-gradient(135deg, #fff0f0, #ffe0e0);
      color: var(--danger);
      font-weight: 700;
      animation: shake 0.4s ease;
    }
    @keyframes bounceUp {
      0%   { transform: scale(1); }
      40%  { transform: scale(1.1); }
      100% { transform: scale(1.03); }
    }
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%  { transform: translateX(-7px); }
      40%  { transform: translateX(7px); }
      60%  { transform: translateX(-4px); }
      80%  { transform: translateX(4px); }
    }

    /* â”€â”€ FEEDBACK â”€â”€ */
    .feedback {
      text-align: center;
      padding: 16px 20px;
      border-radius: 14px;
      font-size: 17px;
      font-weight: 700;
      margin: 14px 0;
    }
    .feedback.correct {
      background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      color: #059669;
      border: 1.5px solid rgba(16,185,129,0.25);
      animation: feedbackPop 0.35s cubic-bezier(0.34,1.56,0.64,1);
    }
    .feedback.wrong {
      background: linear-gradient(135deg, #fff0f0, #ffe0e0);
      color: var(--danger);
      border: 1.5px solid rgba(255,71,87,0.25);
      animation: shake 0.4s ease;
    }
    @keyframes feedbackPop {
      from { opacity: 0; transform: scale(0.9); }
      to   { opacity: 1; transform: scale(1); }
    }

    /* â”€â”€ HINT â”€â”€ */
    .hint-display {
      text-align: center;
      font-size: 28px;
      font-family: 'Fira Code', 'Courier New', monospace;
      letter-spacing: 7px;
      color: #a06000;
      background: linear-gradient(135deg, #fffde7, #fff3cc);
      border: 2px dashed var(--warning);
      border-radius: 14px;
      padding: 14px;
      margin: 10px 0;
      font-weight: 500;
      animation: hintGlow 0.35s ease;
    }
    @keyframes hintGlow {
      0%   { box-shadow: 0 0 0   rgba(255,165,0,0);   transform: scale(1); }
      40%  { box-shadow: 0 0 30px rgba(255,165,0,0.5); transform: scale(1.02); }
      100% { box-shadow: 0 0 0   rgba(255,165,0,0);   transform: scale(1); }
    }

    /* â”€â”€ SCORE SCREEN â”€â”€ */
    .score-screen { text-align: center; }
    .score-circle {
      width: 136px; height: 136px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      margin: 0 auto 22px;
      font-size: 34px; font-weight: 800;
      box-shadow: 0 16px 48px rgba(14,165,233,0.45);
      animation: scorePop 0.65s cubic-bezier(0.34,1.56,0.64,1) both;
    }
    @keyframes scorePop {
      from { transform: scale(0) rotate(-15deg); opacity: 0; }
      to   { transform: scale(1) rotate(0deg);   opacity: 1; }
    }
    .score-circle span.lbl { font-size: 12px; font-weight: 500; opacity: 0.85; }
    .score-msg { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
    .review-list { text-align: left; margin-top: 22px; }
    .review-item {
      background: linear-gradient(135deg, #fff4f4, #ffe8e8);
      border-radius: 12px;
      padding: 10px 14px;
      margin-bottom: 8px;
      font-size: 14px;
      border-left: 4px solid var(--danger);
    }
    .correct-answer { color: var(--success); font-weight: 700; }

    /* â”€â”€ HOME â”€â”€ */
    .home-top { text-align: center; }
    .home-top h1 {
      font-size: 34px; font-weight: 900; letter-spacing: -1px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .test-date {
      display: inline-block;
      background: linear-gradient(135deg, #0EA5E9, #22D3EE);
      color: white; font-size: 14px; font-weight: 700;
      padding: 7px 20px; border-radius: 50px;
      margin: 10px 0 18px;
      box-shadow: 0 8px 20px rgba(14,165,233,0.4);
      animation: pulse 2.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0%,100% { box-shadow: 0 8px 20px rgba(14,165,233,0.4); }
      50%      { box-shadow: 0 12px 32px rgba(14,165,233,0.65); transform: scale(1.02); }
    }

    .sec-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top: 26px; }
    .sec-card {
      border: none; border-radius: 20px;
      padding: 24px 16px; color: white;
      cursor: pointer; transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
      text-align: center; font-family: 'Poppins', sans-serif;
      box-shadow: 0 10px 28px rgba(0,0,0,0.18);
    }
    .sec-card:hover { transform: translateY(-6px) scale(1.03); box-shadow: 0 20px 48px rgba(0,0,0,0.25); }
    .sec-card .em { font-size: 34px; margin-bottom: 10px; display: block; filter: drop-shadow(0 3px 6px rgba(0,0,0,0.2)); }
    .sec-card h3  { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
    .sec-card p   { font-size: 12px; opacity: 0.88; }
    .c1 { background: linear-gradient(135deg, #0EA5E9, #38BDF8); }
    .c2 { background: linear-gradient(135deg, #06B6D4, #22D3EE); }
    .c3 { background: linear-gradient(135deg, #0284C7, #0EA5E9); }
    .c4 { background: linear-gradient(135deg, #10B981, #34D399); }
    .c4 h3, .c4 p { color: white; }

    /* â”€â”€ INFO BOX â”€â”€ */
    .info-box {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border-radius: 14px;
      padding: 14px 16px;
      font-size: 13px;
      margin-bottom: 18px;
      line-height: 1.9;
      border: 1.5px solid rgba(14,165,233,0.2);
    }

    /* â”€â”€ WRITING â”€â”€ */
    .w-prompt {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border-radius: 14px; padding: 18px;
      margin-bottom: 14px; font-size: 17px; font-weight: 600;
      border-left: 5px solid var(--primary);
    }
    .w-prompt .heb { font-size: 13px; color: var(--muted); margin-top: 6px; font-weight: 400; }
    .w-textarea {
      width: 100%; height: 175px;
      padding: 15px; font-size: 16px;
      font-family: 'Poppins', sans-serif;
      border: 2px solid #eaeaf8;
      border-radius: 14px; resize: vertical; outline: none;
      line-height: 1.75; transition: all 0.25s; color: var(--text);
      background: #fafafe;
    }
    .w-textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 5px rgba(14,165,233,0.1);
      background: white;
    }
    .word-count-wrap { text-align: right; margin-top: 8px; }
    .word-count {
      display: inline-block;
      font-size: 13px; font-weight: 700;
      padding: 5px 14px; border-radius: 50px;
      transition: all 0.3s;
    }
    .word-count.low  { background: #fff0f0; color: var(--danger); }
    .word-count.good { background: #e6fff8; color: #059669; animation: goodPulse 0.5s ease; }
    .word-count.high { background: #fff8e1; color: var(--warning); }
    @keyframes goodPulse {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    .bank-section { margin-top: 22px; }
    .bank-section h3 { font-size: 15px; font-weight: 700; margin-bottom: 10px; }
    .bank-label {
      font-weight: 700; font-size: 11px; color: var(--muted);
      margin: 12px 0 7px; text-transform: uppercase; letter-spacing: 1px;
    }
    .chips { display: flex; flex-wrap: wrap; gap: 7px; }
    .chip {
      padding: 5px 14px; border-radius: 50px; font-size: 13px;
      cursor: pointer; transition: all 0.22s cubic-bezier(0.34,1.56,0.64,1);
      border: 1.5px solid; font-family: 'Poppins', sans-serif; font-weight: 500;
    }
    .chip:hover { transform: translateY(-3px) scale(1.06); box-shadow: 0 6px 16px rgba(0,0,0,0.14); }
    .chip-blue  { background: #eef2ff; border-color: var(--primary); color: var(--primary); }
    .chip-blue:hover  { background: var(--primary); color: white; }
    .chip-green { background: #e6fff8; border-color: var(--success); color: #059669; }
    .chip-green:hover { background: var(--success); color: white; }
    .chip-red   { background: #fff0f0; border-color: var(--danger); color: var(--danger); }
    .chip-red:hover   { background: var(--danger); color: white; }

    .checklist {
      background: linear-gradient(135deg, #fffde7, #fff8e1);
      border-radius: 18px; padding: 20px; margin-top: 22px;
      border: 1.5px solid rgba(255,165,0,0.2);
      box-shadow: 0 4px 16px rgba(255,165,0,0.08);
    }
    .checklist h3 { font-size: 15px; font-weight: 700; color: #856404; margin-bottom: 14px; }
    .check-row { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; cursor: pointer; }
    .check-row input { width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; margin-top: 2px; accent-color: var(--primary); }
    .check-row label { font-size: 14px; cursor: pointer; font-weight: 500; }

    /* â”€â”€ CHECK TEXT RESULT â”€â”€ */
    .check-result-panel {
      margin-top: 16px;
      border-radius: 18px;
      overflow: hidden;
      border: 2px solid #eaeaf8;
      animation: fadeSlideUp 0.4s cubic-bezier(0.22,1,0.36,1) both;
      box-shadow: 0 8px 28px rgba(14,165,233,0.1);
    }
    .check-result-header {
      background: linear-gradient(135deg, var(--primary), #9b93ff);
      color: white;
      padding: 13px 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 700;
      font-size: 15px;
    }
    .check-close-btn {
      background: rgba(255,255,255,0.2);
      border: none; color: white;
      width: 28px; height: 28px;
      border-radius: 50%; cursor: pointer;
      font-size: 14px; font-weight: bold;
      transition: all 0.2s; flex-shrink: 0;
    }
    .check-close-btn:hover { background: rgba(255,255,255,0.4); transform: scale(1.1); }
    .annotated-box {
      padding: 18px;
      font-size: 16px;
      line-height: 2;
      background: #fafafe;
      font-family: 'Poppins', sans-serif;
      border-bottom: 1px solid #eaeaf8;
      white-space: pre-wrap;
      word-break: break-word;
    }
    /* Error highlight types */
    .err-verb {
      background: #ffd6d6;
      border-bottom: 2.5px solid var(--danger);
      border-radius: 4px;
      padding: 1px 4px;
      cursor: help;
      font-weight: 700;
      transition: background 0.2s;
    }
    .err-verb:hover { background: #ffb3b3; }
    .err-capital {
      background: #ffe0b2;
      border-bottom: 2.5px solid var(--warning);
      border-radius: 4px;
      padding: 1px 4px;
      cursor: help;
      font-weight: 700;
    }
    .err-capital:hover { background: #ffcc80; }
    .err-punct {
      background: #fff9c4;
      border-bottom: 2.5px solid #f9a825;
      border-radius: 4px;
      padding: 1px 4px;
      cursor: help;
    }
    .check-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px 16px;
      background: #f8f9ff;
      border-bottom: 1px solid #eaeaf8;
      font-size: 12px;
      font-weight: 600;
      align-items: center;
    }
    .legend-chip { display: flex; align-items: center; gap: 6px; }
    .err-list { padding: 14px 16px; }
    .err-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 9px 13px;
      border-radius: 10px;
      margin-bottom: 7px;
      font-size: 13px;
      font-weight: 500;
      line-height: 1.5;
    }
    .err-item.verb    { background: #fff0f0; border-left: 4px solid var(--danger); }
    .err-item.capital { background: #fff5ee; border-left: 4px solid var(--warning); }
    .err-item.punct   { background: #fffff0; border-left: 4px solid #f9a825; }
    .no-errors {
      text-align: center; padding: 24px;
      font-size: 18px; font-weight: 800;
      color: var(--success);
      animation: scorePop 0.5s cubic-bezier(0.34,1.56,0.64,1);
    }

    /* â”€â”€ CONFETTI â”€â”€ */
    .confetti-container {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 999; overflow: hidden;
    }
    .confetti-piece {
      position: absolute;
      border-radius: 2px;
      animation: confFall linear forwards;
    }
    @keyframes confFall {
      0%   { transform: translateY(-30px) rotate(0deg); opacity: 1; }
      85%  { opacity: 1; }
      100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
    }

    /* â”€â”€ CHANGE TOPIC BTN â”€â”€ */
    .topic-btn {
      background: none;
      border: 1.5px solid #d0d0e8;
      padding: 6px 16px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 12px;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 14px;
      transition: all 0.2s;
    }
    .topic-btn:hover { border-color: var(--primary); color: var(--primary); transform: scale(1.05); }

    /* â”€â”€ EMOJI BURST â”€â”€ */
    .emoji-burst {
      position: fixed;
      font-size: 28px;
      pointer-events: none;
      z-index: 998;
      animation: emojiFly 0.9s ease-out forwards;
    }
    @keyframes emojiFly {
      0%   { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-100px) scale(1.4); }
    }

    @media (max-width: 480px) {
      .opt-grid   { grid-template-columns: 1fr; }
      .sec-cards  { grid-template-columns: 1fr; }
      .card       { padding: 22px 18px; }
      .q-word     { font-size: 26px; }
    }
  </style>
</head>
<body>

<nav>
  <button class="nav-btn" onclick="goHome()">ğŸ  Home</button>
  <button class="nav-btn" onclick="goSection('spelling')">âœï¸ Spelling</button>
  <button class="nav-btn" onclick="goSection('meaning')">ğŸ“– Meaning</button>
  <button class="nav-btn" onclick="goSection('grammar')">ğŸ“ Grammar</button>
  <button class="nav-btn" onclick="goSection('writing')">âœï¸ Writing</button>
</nav>

<div class="container">

  <!-- â•â•â•â• HOME â•â•â•â• -->
  <div id="s-home" class="card card-anim home-top">
    <div style="font-size:56px; margin-bottom:14px; filter:drop-shadow(0 4px 8px rgba(14,165,233,0.3));">ğŸ“š</div>
    <h1>English Practice</h1>
    <div class="heb" style="font-size:17px; margin-top:6px;">×ª×¨×’×•×œ ×× ×’×œ×™×ª ×›×™×ª×” ×–×³</div>
    <div class="test-date">ğŸ“… Test: February 26â€“27, 2026</div>
    <p style="color:var(--muted); font-size:14px; font-weight:500;">Choose a section to start practicing!</p>
    <div class="heb" style="margin-top:4px;">×‘×—×¨×• ×—×œ×§ ×œ×ª×¨×’×•×œ. ×ª×•×›×œ×• ×œ×ª×¨×’×œ ×›××” ×¤×¢××™× ×©×ª×¨×¦×•!</div>

    <div class="sec-cards">
      <button class="sec-card c1" onclick="goSection('spelling')">
        <span class="em">âœï¸</span>
        <h3>Spelling</h3>
        <p>××™×•×ª ××™×œ×™×<br>Type the English word</p>
      </button>
      <button class="sec-card c2" onclick="goSection('meaning')">
        <span class="em">ğŸ“–</span>
        <h3>Meaning</h3>
        <p>××©××¢×•×ª ××™×œ×™×<br>Choose the correct meaning</p>
      </button>
      <button class="sec-card c3" onclick="goSection('grammar')">
        <span class="em">ğŸ“</span>
        <h3>Grammar</h3>
        <p>×“×§×“×•×§ â€“ Past Simple<br>Past tense sentences</p>
      </button>
      <button class="sec-card c4" onclick="goSection('writing')">
        <span class="em">âœï¸</span>
        <h3>Writing</h3>
        <p>×›×ª×™×‘×”<br>Practice writing in past tense</p>
      </button>
    </div>
  </div>

  <!-- â•â•â•â• SPELLING â•â•â•â• -->
  <div id="s-spelling" class="hidden">
    <div id="sp-quiz" class="card card-anim">
      <div class="section-header">
        <h1>âœï¸ Spelling Quiz</h1>
        <div class="heb">×§×™×– ××™×•×ª â€” ×›×ª×‘×• ××ª ×”××™×œ×” ×‘×× ×’×œ×™×ª</div>
      </div>
      <div class="prog-bar"><div class="prog-fill" id="sp-prog"></div></div>
      <div class="prog-text" id="sp-prog-text"></div>

      <p class="q-instruction">
        What is the English word for? &nbsp;|&nbsp;
        <span style="direction:rtl;display:inline-block;">××” ×”××™×œ×” ×‘×× ×’×œ×™×ª?</span>
      </p>
      <div class="q-word" id="sp-word" style="direction:rtl;"></div>

      <input class="ans-input" id="sp-input" type="text"
        placeholder="Type the English word here..."
        onkeydown="if(event.key==='Enter') spCheck()">

      <button class="btn btn-yellow" id="sp-btn-hint" onclick="spHint()" style="font-size:14px; padding:11px;">
        ğŸ’¡ Hint â€“ show a letter &nbsp;|&nbsp; ×¨××– â€“ ×’×œ×• ××•×ª
      </button>
      <div class="hint-display hidden" id="sp-hint-display"></div>

      <div class="feedback hidden" id="sp-feedback"></div>
      <button class="btn btn-blue"  id="sp-btn-check" onclick="spCheck()">Check âœ“ &nbsp;|&nbsp; ×‘×“×•×§</button>
      <button class="btn btn-green hidden" id="sp-btn-next" onclick="spNext()">Next â†’ &nbsp;|&nbsp; ×”×‘×</button>
    </div>
    <div id="sp-score" class="card card-anim hidden"></div>
  </div>

  <!-- â•â•â•â• MEANING â•â•â•â• -->
  <div id="s-meaning" class="hidden">
    <div id="mn-quiz" class="card card-anim">
      <div class="section-header">
        <h1>ğŸ“– Meaning Match</h1>
        <div class="heb">×”×ª×××ª ××©××¢×•×ª â€” ×‘×—×¨×• ××ª ×”×ª×¨×’×•× ×”× ×›×•×Ÿ</div>
      </div>
      <div class="prog-bar"><div class="prog-fill" id="mn-prog"></div></div>
      <div class="prog-text" id="mn-prog-text"></div>

      <p class="q-instruction">What does this word mean? &nbsp;|&nbsp; ××” ×¤×™×¨×•×© ×”××™×œ×”?</p>
      <div class="q-word" id="mn-word" style="direction:ltr;"></div>

      <div class="opt-grid" id="mn-opts"></div>
      <div class="feedback hidden" id="mn-feedback"></div>
      <button class="btn btn-green hidden" id="mn-btn-next" onclick="mnNext()">Next â†’ &nbsp;|&nbsp; ×”×‘×</button>
    </div>
    <div id="mn-score" class="card card-anim hidden"></div>
  </div>

  <!-- â•â•â•â• GRAMMAR â•â•â•â• -->
  <div id="s-grammar" class="hidden">
    <div id="gr-quiz" class="card card-anim">
      <div class="section-header">
        <h1>ğŸ“ Grammar â€“ Past Simple</h1>
        <div class="heb">×–××Ÿ ×¢×‘×¨ â€” ×‘×—×¨×• ××ª ×”×¦×•×¨×” ×”× ×›×•× ×”</div>
      </div>
      <div class="prog-bar"><div class="prog-fill" id="gr-prog"></div></div>
      <div class="prog-text" id="gr-prog-text"></div>

      <div class="info-box">
        <strong>Remember | ×–×›×¨×•:</strong><br>
        âœ… <strong>Positive:</strong> I <em>went</em> / She <em>ate</em> / They <em>saw</em><br>
        âŒ <strong>Negative:</strong> I <em>didn't go</em> / She <em>didn't eat</em><br>
        â“ <strong>Question:</strong> <em>Did</em> you go? / <em>Did</em> she eat?
      </div>

      <div class="q-word" id="gr-sentence" style="direction:ltr; font-size:19px; line-height:1.7;"></div>
      <div class="opt-grid" id="gr-opts"></div>
      <div class="feedback hidden" id="gr-feedback"></div>
      <button class="btn btn-green hidden" id="gr-btn-next" onclick="grNext()">Next â†’ &nbsp;|&nbsp; ×”×‘×</button>
    </div>
    <div id="gr-score" class="card card-anim hidden"></div>
  </div>

  <!-- â•â•â•â• WRITING â•â•â•â• -->
  <div id="s-writing" class="hidden">
    <div class="card card-anim">
      <div class="section-header">
        <h1>âœï¸ Writing Practice</h1>
        <div class="heb">×ª×¨×’×•×œ ×›×ª×™×‘×” â€” ×›×ª×‘×• ×‘×–××Ÿ ×¢×‘×¨</div>
      </div>

      <div class="info-box">
        <strong>What you need to do | ××” ×¦×¨×™×š ×œ×¢×©×•×ª:</strong><br>
        ğŸ“ Write <strong>40â€“60 words</strong> &nbsp;|&nbsp; ×›×ª×‘×• 40â€“60 ××™×œ×™×<br>
        âŒ Include <strong>at least 2 negative sentences</strong> &nbsp;|&nbsp; ×œ×¤×—×•×ª 2 ××©×¤×˜×™× ×©×œ×™×œ×™×™×<br>
        ğŸ”— Use <strong>linking words</strong> (first, then, next, finallyâ€¦) &nbsp;|&nbsp; ×”×©×ª××©×• ×‘××™×œ×•×ª ×§×™×©×•×¨<br>
        âª Write everything in <strong>past tense</strong> &nbsp;|&nbsp; ×›×œ ×”××©×¤×˜×™× ×‘×–××Ÿ ×¢×‘×¨
      </div>

      <div class="w-prompt" id="w-prompt"></div>
      <button class="topic-btn" onclick="changePrompt()">ğŸ”„ Change topic &nbsp;|&nbsp; ×”×—×œ×£ × ×•×©×</button>

      <textarea class="w-textarea" id="w-text"
        placeholder="Start writing here... | ×›×ª×‘×• ×›××Ÿ..."
        oninput="updateCount()"></textarea>
      <div class="word-count-wrap">
        <span class="word-count low" id="w-count">0 words | ××™×œ×™×</span>
      </div>

      <button class="btn btn-blue" onclick="checkWriting()" style="margin-top:14px;">
        ğŸ” Check Text | ×‘×“×™×§×ª ×˜×§×¡×˜
      </button>
      <div id="w-check-result" class="check-result-panel hidden"></div>

      <div class="bank-section">
        <h3>ğŸ“š Word Bank &nbsp;<small style="color:var(--muted);font-weight:400;font-size:12px;">(click to add | ×œ×—×¦×• ×œ×”×•×¡×™×£)</small></h3>
        <div class="bank-label">ğŸ”— Linking words | ××™×œ×•×ª ×§×™×©×•×¨</div>
        <div class="chips" id="chips-link"></div>
        <div class="bank-label">âŒ Negatives | ×©×œ×™×œ×”</div>
        <div class="chips" id="chips-neg"></div>
        <div class="bank-label">ğŸ“– Useful words | ××™×œ×™× ×©×™××•×©×™×•×ª</div>
        <div class="chips" id="chips-vocab"></div>
      </div>

      <div class="checklist">
        <h3>âœ… Checklist &nbsp;|&nbsp; ×¨×©×™××ª ×‘×“×™×§×”</h3>
        <div class="check-row"><input type="checkbox" id="ck1"><label for="ck1">I wrote 50â€“60 words <span class="heb" style="display:inline;">| ×›×ª×‘×ª×™ 50â€“60 ××™×œ×™×</span></label></div>
        <div class="check-row"><input type="checkbox" id="ck2"><label for="ck2">I used Past Simple tense <span class="heb" style="display:inline;">| ×›×ª×‘×ª×™ ×‘×–××Ÿ ×¢×‘×¨</span></label></div>
        <div class="check-row"><input type="checkbox" id="ck3"><label for="ck3">I have at least 2 negative sentences (didn't / wasn't / weren't) <span class="heb" style="display:inline;">| ×œ×¤×—×•×ª 2 ××©×¤×˜×™× ×©×œ×™×œ×™×™×</span></label></div>
        <div class="check-row"><input type="checkbox" id="ck4"><label for="ck4">I used linking words (first, then, next, finallyâ€¦) <span class="heb" style="display:inline;">| ×”×©×ª××©×ª×™ ×‘××™×œ×•×ª ×§×™×©×•×¨</span></label></div>
        <div class="check-row"><input type="checkbox" id="ck5"><label for="ck5">I checked my spelling <span class="heb" style="display:inline;">| ×‘×“×§×ª×™ ××ª ×”××™×•×ª ×©×œ×™</span></label></div>
      </div>
    </div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const SPELLING = [
  { heb: '×¤×¢×•×œ×”',         eng: 'action' },
  { heb: '×‘×¨×’×¢',          eng: 'now' },
  { heb: '×—×¤×¥',           eng: 'object' },
  { heb: '×–×” ×ª×œ×•×™',       eng: 'it depends' },
  { heb: '×‘×™×ª ×›× ×¡×ª',      eng: 'synagogue' },
  { heb: '×©×œ×•×•×”',         eng: 'peace' },
  { heb: '×©×™××•×©×™',        eng: 'useful' },
  { heb: '×œ×”×™×•×ª ××¡×•×’×œ ×œ', eng: 'be able to' },
  { heb: '×¨×’×™×œ',          eng: 'ordinary' },
  { heb: '×œ××¨×•×ª ×©',       eng: 'although' },
  { heb: '×™×©× ×” ×‘×¢×™×”',     eng: 'have a problem' },
  { heb: '×œ×”×™×©××¨',        eng: 'remain' },
  { heb: '×œ×”×ª×¢×§×©',        eng: 'insist' },
  { heb: '×œ×”×¦×™×¢',         eng: 'suggest' },
  { heb: '×œ×”×™×¢×œ×',        eng: 'disappear' },
  { heb: '×œ×—×§×•×¨',         eng: 'explore' },
  { heb: '×©×œ×™×˜×”',         eng: 'control' },
  { heb: '×‘×œ×ª×™ ××¤×©×¨×™',    eng: 'impossible' },
  { heb: '×œ×—×–×•×¨ ×¢×œ',      eng: 'repeat' },
  { heb: '× ×¤×œ×',          eng: 'wonderful' },
];

const MEANING = [
  { eng: 'solve',                  heb: '×œ×¤×ª×•×¨' },
  { eng: 'vacation',               heb: '×—×•×¤×©×”' },
  { eng: 'adventure',              heb: '×”×¨×¤×ª×§×”' },
  { eng: 'as quickly as possible', heb: '×›××” ×©×™×•×ª×¨ ××”×¨' },
  { eng: 'advantage',              heb: '×™×ª×¨×•×Ÿ' },
  { eng: 'definitely',             heb: '×‘×”×—×œ×˜' },
  { eng: 'passenger',              heb: '× ×•×¡×¢' },
  { eng: 'anywhere',               heb: '×‘×›×œ ××§×•×' },
  { eng: 'however',                heb: '×¢× ×–××ª' },
  { eng: 'immediately',            heb: '××™×“' },
  { eng: 'ordinary',               heb: '×¨×’×™×œ' },
  { eng: 'especially',             heb: '×‘××™×•×—×“' },
  { eng: 'suddenly',               heb: '×¤×ª××•×' },
  { eng: 'effect',                 heb: '×”×©×¤×¢×”' },
  { eng: 'throughout',             heb: '×‘××”×œ×š' },
  { eng: 'experience',             heb: '×—×•×•×™×”' },
  { eng: 'population',             heb: '××•×›×œ×•×¡×™×™×”' },
  { eng: 'share',                  heb: '×œ×—×œ×•×§' },
  { eng: 'mystery',                heb: '×ª×¢×œ×•××”' },
  { eng: 'opinion',                heb: '×“×¢×”' },
];

const GRAMMAR = [
  { sentence: 'Yesterday, I ___ to the park.',         answer: 'went',   options: ['went','go','goed','goes'],          note: 'go â†’ went âœ…' },
  { sentence: 'She ___ a pizza for dinner last night.', answer: 'ate',    options: ['ate','eat','eated','eats'],         note: 'eat â†’ ate âœ…' },
  { sentence: 'We ___ a great movie on Friday.',        answer: 'saw',    options: ['saw','see','seed','sees'],          note: 'see â†’ saw âœ…' },
  { sentence: 'He ___ juice for breakfast.',            answer: 'drank',  options: ['drank','drink','drinked','drinks'], note: 'drink â†’ drank âœ…' },
  { sentence: 'I ___ for nine hours last night.',       answer: 'slept',  options: ['slept','sleep','sleeped','sleeps'], note: 'sleep â†’ slept âœ…' },
  { sentence: 'They ___ their friends at the mall.',    answer: 'met',    options: ['met','meet','meeted','meets'],      note: 'meet â†’ met âœ…' },
  { sentence: 'The lesson ___ very interesting.',       answer: 'was',    options: ['was','were','is','be'],             note: 'is/am â†’ was (singular) âœ…' },
  { sentence: 'The students ___ happy at the party.',   answer: 'were',   options: ['were','was','are','be'],            note: 'are â†’ were (plural) âœ…' },
  { sentence: 'I ___ go to the store yesterday.',       answer: "didn't", options: ["didn't","don't","not","wasn't"],    note: "Negative: didn't + base verb âŒ" },
  { sentence: 'She ___ eat breakfast this morning.',    answer: "didn't", options: ["didn't","don't","doesn't","wasn't"],note: "Negative: didn't + base verb âŒ" },
  { sentence: 'He ___ see the film last week.',         answer: "didn't", options: ["didn't","don't","not","wasn't"],    note: "Negative: didn't + base verb âŒ" },
  { sentence: '___ you go to the party last night?',   answer: 'Did',    options: ['Did','Do','Does','Was'],            note: 'Question: Did + subject + base verb â“' },
  { sentence: '___ she meet her friends yesterday?',    answer: 'Did',    options: ['Did','Do','Does','Were'],           note: 'Question: Did + subject + base verb â“' },
  { sentence: '___ they eat at the restaurant?',        answer: 'Did',    options: ['Did','Do','Have','Were'],           note: 'Question: Did + subject + base verb â“' },
];

const PROMPTS = [
  { eng: 'Write about your last vacation.',                       heb: '×›×ª×‘×• ×¢×œ ×”×—×•×¤×©×” ×”××—×¨×•× ×” ×©×œ×›×.' },
  { eng: 'Write about a wonderful adventure you had.',            heb: '×›×ª×‘×• ×¢×œ ×”×¨×¤×ª×§×” × ×¤×œ××” ×©×”×™×™×ª×” ×œ×›×.' },
  { eng: 'Write about something interesting that happened last week.', heb: '×›×ª×‘×• ×¢×œ ××©×”×• ××¢× ×™×™×Ÿ ×©×§×¨×” ×©×‘×•×¢ ×©×¢×‘×¨.' },
  { eng: 'Write about a special experience with your family.',    heb: '×›×ª×‘×• ×¢×œ ×—×•×•×™×” ××™×•×—×“×ª ×¢× ×”××©×¤×—×” ×©×œ×›×.' },
  { eng: 'Write about a mystery you tried to solve.',             heb: '×›×ª×‘×• ×¢×œ ×ª×¢×œ×•××” ×©× ×™×¡×™×ª× ×œ×¤×ª×•×¨.' },
];

const LINKING  = ['Yesterday,','Last week,','First,','Then,','Next,','After that,','Finally,','Also,'];
const NEGATIVES = ["didn't go","didn't eat","didn't see","didn't want","didn't like","wasn't","weren't","didn't do"];
const VOCAB     = ['adventure','vacation','wonderful','suddenly','immediately','especially','although','however','experience','decided','enjoyed','visited','amazing','exciting','ordinary'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const shuffle = arr => [...arr].sort(() => Math.random() - 0.5);
const get     = id  => document.getElementById(id);
const show    = id  => get(id).classList.remove('hidden');
const hide    = id  => get(id).classList.add('hidden');
const setText = (id,t) => get(id).textContent = t;
const setHTML = (id,h) => get(id).innerHTML   = h;

function reAnimate(id) {
  const el = get(id);
  el.classList.remove('card-anim');
  void el.offsetWidth; // reflow
  el.classList.add('card-anim');
}

function animWord(id) {
  const el = get(id);
  el.classList.remove('anim');
  void el.offsetWidth;
  el.classList.add('anim');
}

function addRipple(btn, e) {
  const r = document.createElement('span');
  r.className = 'ripple';
  const rect = btn.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  r.style.width = r.style.height = size + 'px';
  r.style.left = (e.clientX - rect.left - size/2) + 'px';
  r.style.top  = (e.clientY - rect.top  - size/2) + 'px';
  btn.appendChild(r);
  setTimeout(() => r.remove(), 600);
}
document.querySelectorAll('.btn').forEach(b => b.addEventListener('click', e => addRipple(b, e)));

function launchConfetti() {
  const wrap = document.createElement('div');
  wrap.className = 'confetti-container';
  document.body.appendChild(wrap);
  const colors = ['#6C63FF','#FF6584','#00C896','#FFA502','#4facfe','#f093fb','#ffde57'];
  for (let i = 0; i < 70; i++) {
    const p = document.createElement('div');
    p.className = 'confetti-piece';
    p.style.cssText = `
      left: ${Math.random()*100}%;
      width: ${6 + Math.random()*10}px;
      height: ${6 + Math.random()*10}px;
      background: ${colors[Math.floor(Math.random()*colors.length)]};
      border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
      animation-delay: ${Math.random()*0.9}s;
      animation-duration: ${1.4 + Math.random()*0.9}s;
    `;
    wrap.appendChild(p);
  }
  setTimeout(() => wrap.remove(), 3000);
}

function spawnEmoji(emoji, x, y) {
  const el = document.createElement('div');
  el.className = 'emoji-burst';
  el.textContent = emoji;
  el.style.left = x + 'px';
  el.style.top  = y + 'px';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 900);
}

function scoreMsg(pct) {
  if (pct === 100) return { en: 'ğŸ† Perfect!',        he: '××•×©×œ×! ×›×œ ×”×›×‘×•×“!' };
  if (pct >= 80)   return { en: 'ğŸ‰ Excellent!',       he: '××¦×•×™×Ÿ! ×›×œ ×”×›×‘×•×“!' };
  if (pct >= 60)   return { en: 'ğŸ‘ Good effort!',     he: '×¢×‘×•×“×” ×˜×•×‘×”!' };
  return                  { en: 'ğŸ’ª Keep practicing!', he: '×”××©×™×›×• ×œ×”×ª×××Ÿ!' };
}

function buildScoreHTML(score, total, wrong, wrongRenderer, sectionId) {
  const pct = Math.round(score / total * 100);
  const msg = scoreMsg(pct);
  let rev = '';
  if (wrong.length) {
    rev = '<div class="review-list"><h3 style="margin-bottom:10px; font-size:15px;">Review these | ×—×–×¨×• ×¢×œ:</h3>';
    wrong.forEach(w => rev += wrongRenderer(w));
    rev += '</div>';
  }
  return `
    <div class="score-circle">
      <span>${score}/${total}</span>
      <span class="lbl">${pct}%</span>
    </div>
    <div class="score-msg">${msg.en}</div>
    <div class="heb" style="margin-top:4px; margin-bottom:16px;">${msg.he}</div>
    ${rev}
    <button class="btn btn-blue"  style="margin-top:22px;" onclick="goSection('${sectionId}')">ğŸ”„ Try Again | × ×¡×• ×©×•×‘</button>
    <button class="btn btn-gray"  style="margin-top:10px;" onclick="goHome()">ğŸ  Back to Home | ×—×–×¨×”</button>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const SECTIONS = ['home','spelling','meaning','grammar','writing'];

function goHome() {
  SECTIONS.forEach(s => hide('s-' + s));
  show('s-home');
  reAnimate('s-home');
}

function goSection(name) {
  SECTIONS.forEach(s => hide('s-' + s));
  show('s-' + name);
  if (name === 'spelling') spInit();
  if (name === 'meaning')  mnInit();
  if (name === 'grammar')  grInit();
  if (name === 'writing')  wInit();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SPELLING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let spOrder=[], spIdx=0, spScore=0, spWrong=[], spDone=false, spHintCount=0;

function spInit() {
  spOrder = shuffle(SPELLING); spIdx = 0; spScore = 0; spWrong = [];
  show('sp-quiz'); hide('sp-score');
  reAnimate('sp-quiz');
  spShow();
}

function spShow() {
  const total = spOrder.length;
  if (spIdx >= total) { spShowScore(); return; }
  const w = spOrder[spIdx];

  setText('sp-word', w.heb);
  animWord('sp-word');
  get('sp-input').value = '';
  get('sp-input').disabled = false;
  hide('sp-feedback');
  hide('sp-hint-display');

  const hBtn = get('sp-btn-hint');
  hBtn.disabled = false;
  hBtn.textContent = 'ğŸ’¡ Hint â€“ show a letter | ×¨××– â€“ ×’×œ×• ××•×ª';

  show('sp-btn-check'); hide('sp-btn-next');
  get('sp-prog').style.width = (spIdx / total * 100) + '%';
  setText('sp-prog-text', `Question ${spIdx + 1} / ${total}`);
  spDone = false; spHintCount = 0;
  setTimeout(() => get('sp-input').focus(), 80);
}

function spCheck() {
  if (spDone) return;
  const val = get('sp-input').value.trim().toLowerCase();
  if (!val) return;
  spDone = true;
  get('sp-input').disabled = true;
  hide('sp-btn-check'); show('sp-btn-next');

  const correct = spOrder[spIdx].eng.toLowerCase();
  const fb = get('sp-feedback');
  show('sp-feedback');

  if (val === correct) {
    spScore++;
    fb.className = 'feedback correct';
    fb.textContent = 'âœ… Correct! | × ×›×•×Ÿ!';
    const rect = get('sp-feedback').getBoundingClientRect();
    spawnEmoji('â­', rect.left + rect.width/2, rect.top);
  } else {
    spWrong.push({ heb: spOrder[spIdx].heb, eng: spOrder[spIdx].eng, given: val });
    fb.className = 'feedback wrong';
    fb.textContent = `âŒ Correct answer: "${spOrder[spIdx].eng}" | ×”×ª×©×•×‘×” ×”× ×›×•× ×” ×”×™×`;
  }
}

function spHint() {
  if (spDone) return;
  const eng = spOrder[spIdx].eng;
  spHintCount++;

  let revealed = 0, hintStr = '';
  for (let i = 0; i < eng.length; i++) {
    if (eng[i] === ' ') {
      hintStr += '  ';
    } else if (revealed < spHintCount) {
      hintStr += eng[i];
      revealed++;
    } else {
      hintStr += '_';
    }
  }

  const hintDiv = get('sp-hint-display');
  hintDiv.textContent = hintStr;
  show('sp-hint-display');
  // Re-trigger glow animation
  hintDiv.style.animation = 'none';
  void hintDiv.offsetWidth;
  hintDiv.style.animation = '';

  const totalLetters = eng.replace(/ /g, '').length;
  const hBtn = get('sp-btn-hint');
  if (spHintCount >= totalLetters) {
    hBtn.disabled = true;
    hBtn.textContent = 'No more hints | ××™×Ÿ ×¢×•×“ ×¨××–×™×';
  } else {
    const left = totalLetters - spHintCount;
    hBtn.textContent = `ğŸ’¡ Show another letter (${left} left) | ×¢×•×“ ××•×ª`;
  }
}

function spNext() { spIdx++; spShow(); }

function spShowScore() {
  hide('sp-quiz'); show('sp-score');
  reAnimate('sp-score');
  const pct = Math.round(spScore / spOrder.length * 100);
  setHTML('sp-score', buildScoreHTML(
    spScore, spOrder.length, spWrong,
    w => `<div class="review-item" style="direction:rtl;">${w.heb} â†’ <span class="correct-answer">${w.eng}</span> <span style="color:#bbb;">(×›×ª×‘×ª: ${w.given})</span></div>`,
    'spelling'
  ));
  if (pct === 100) launchConfetti();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MEANING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let mnOrder=[], mnIdx=0, mnScore=0, mnWrong=[], mnDone=false;

function mnInit() {
  mnOrder = shuffle(MEANING); mnIdx = 0; mnScore = 0; mnWrong = [];
  show('mn-quiz'); hide('mn-score');
  reAnimate('mn-quiz');
  mnShow();
}

function mnShow() {
  const total = mnOrder.length;
  if (mnIdx >= total) { mnShowScore(); return; }
  const w = mnOrder[mnIdx];

  setText('mn-word', w.eng);
  animWord('mn-word');
  hide('mn-feedback'); hide('mn-btn-next');
  get('mn-prog').style.width = (mnIdx / total * 100) + '%';
  setText('mn-prog-text', `Question ${mnIdx + 1} / ${total}`);
  mnDone = false;

  const correct = w.heb;
  const pool = shuffle(mnOrder.filter((_,i) => i !== mnIdx)).map(x => x.heb);
  const opts = shuffle([correct, ...pool.slice(0,3)]);
  const grid = get('mn-opts');
  grid.innerHTML = '';
  opts.forEach(opt => {
    const b = document.createElement('button');
    b.className = 'opt-btn';
    b.style.direction = 'rtl';
    b.textContent = opt;
    b.onclick = e => { addRipple(b,e); mnCheck(b, opt, correct); };
    grid.appendChild(b);
  });
}

function mnCheck(btn, selected, correct) {
  if (mnDone) return;
  mnDone = true;
  document.querySelectorAll('#mn-opts .opt-btn').forEach(b => b.disabled = true);
  show('mn-feedback'); show('mn-btn-next');
  const fb = get('mn-feedback');

  if (selected === correct) {
    mnScore++;
    btn.classList.add('correct');
    fb.className = 'feedback correct';
    fb.textContent = 'âœ… Correct! | × ×›×•×Ÿ!';
    const rect = btn.getBoundingClientRect();
    spawnEmoji('ğŸŒŸ', rect.left + rect.width/2, rect.top);
  } else {
    btn.classList.add('wrong');
    document.querySelectorAll('#mn-opts .opt-btn').forEach(b => { if (b.textContent === correct) b.classList.add('correct'); });
    mnWrong.push({ eng: mnOrder[mnIdx].eng, heb: correct });
    fb.className = 'feedback wrong';
    fb.textContent = `âŒ Correct answer: "${correct}" | ×”×ª×©×•×‘×” ×”× ×›×•× ×” ×”×™×`;
  }
}

function mnNext() { mnIdx++; mnShow(); }

function mnShowScore() {
  hide('mn-quiz'); show('mn-score');
  reAnimate('mn-score');
  const pct = Math.round(mnScore / mnOrder.length * 100);
  setHTML('mn-score', buildScoreHTML(
    mnScore, mnOrder.length, mnWrong,
    w => `<div class="review-item">${w.eng} â†’ <span class="correct-answer">${w.heb}</span></div>`,
    'meaning'
  ));
  if (pct === 100) launchConfetti();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GRAMMAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let grIdx=0, grScore=0, grWrong=[], grDone=false;

function grInit() {
  grIdx = 0; grScore = 0; grWrong = [];
  show('gr-quiz'); hide('gr-score');
  reAnimate('gr-quiz');
  grShow();
}

function grShow() {
  const total = GRAMMAR.length;
  if (grIdx >= total) { grShowScore(); return; }
  const q = GRAMMAR[grIdx];

  get('gr-sentence').innerHTML = q.sentence.replace('___', '<strong style="color:var(--primary);font-size:1.15em;">___</strong>');
  animWord('gr-sentence');
  hide('gr-feedback'); hide('gr-btn-next');
  get('gr-prog').style.width = (grIdx / total * 100) + '%';
  setText('gr-prog-text', `Question ${grIdx + 1} / ${total}`);
  grDone = false;

  const grid = get('gr-opts');
  grid.innerHTML = '';
  shuffle(q.options).forEach(opt => {
    const b = document.createElement('button');
    b.className = 'opt-btn';
    b.style.direction = 'ltr';
    b.textContent = opt;
    b.onclick = e => { addRipple(b,e); grCheck(b, opt, q.answer, q.note); };
    grid.appendChild(b);
  });
}

function grCheck(btn, selected, correct, note) {
  if (grDone) return;
  grDone = true;
  document.querySelectorAll('#gr-opts .opt-btn').forEach(b => b.disabled = true);
  show('gr-feedback'); show('gr-btn-next');
  const fb = get('gr-feedback');

  if (selected === correct) {
    grScore++;
    btn.classList.add('correct');
    fb.className = 'feedback correct';
    fb.innerHTML = `âœ… Correct! | × ×›×•×Ÿ! &nbsp;<small style="font-weight:500;">${note}</small>`;
    const rect = btn.getBoundingClientRect();
    spawnEmoji('âœ¨', rect.left + rect.width/2, rect.top);
  } else {
    btn.classList.add('wrong');
    document.querySelectorAll('#gr-opts .opt-btn').forEach(b => { if (b.textContent === correct) b.classList.add('correct'); });
    grWrong.push({ sentence: GRAMMAR[grIdx].sentence, correct });
    fb.className = 'feedback wrong';
    fb.innerHTML = `âŒ Answer: "<strong>${correct}</strong>" &nbsp;<small style="font-weight:500;">${note}</small>`;
  }
}

function grNext() { grIdx++; grShow(); }

function grShowScore() {
  hide('gr-quiz'); show('gr-score');
  reAnimate('gr-score');
  const pct = Math.round(grScore / GRAMMAR.length * 100);
  setHTML('gr-score', buildScoreHTML(
    grScore, GRAMMAR.length, grWrong,
    w => `<div class="review-item" style="direction:ltr;">${w.sentence.replace('___', `<span class="correct-answer">${w.correct}</span>`)}</div>`,
    'grammar'
  ));
  if (pct === 100) launchConfetti();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WRITING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let promptIdx = 0;

function wInit() {
  promptIdx = 0; setPrompt();
  buildChips('chips-link',  LINKING,   'chip-blue');
  buildChips('chips-neg',   NEGATIVES, 'chip-red');
  buildChips('chips-vocab', VOCAB,     'chip-green');
  get('w-text').value = '';
  updateCount();
}

function setPrompt() {
  const p = PROMPTS[promptIdx];
  setHTML('w-prompt', `<strong>${p.eng}</strong><div class="heb">${p.heb}</div>`);
}

function changePrompt() {
  promptIdx = (promptIdx + 1) % PROMPTS.length;
  setPrompt();
}

function buildChips(containerId, words, cls) {
  const div = get(containerId);
  div.innerHTML = '';
  words.forEach(w => {
    const s = document.createElement('span');
    s.className = 'chip ' + cls;
    s.textContent = w;
    s.onclick = () => insertWord(w);
    div.appendChild(s);
  });
}

function insertWord(word) {
  const ta    = get('w-text');
  const start = ta.selectionStart;
  const end   = ta.selectionEnd;
  const before = ta.value.substring(0, start);
  const after  = ta.value.substring(end);
  const space  = (before.length > 0 && !before.endsWith(' ') && !before.endsWith('\n')) ? ' ' : '';
  ta.value = before + space + word + ' ' + after;
  const pos = start + space.length + word.length + 1;
  ta.selectionStart = ta.selectionEnd = pos;
  ta.focus();
  updateCount();
}

function updateCount() {
  const text  = get('w-text').value.trim();
  const words = text === '' ? 0 : text.split(/\s+/).length;
  const el    = get('w-count');
  el.style.animation = 'none'; void el.offsetWidth;

  if (words < 40) {
    el.className = 'word-count low';
    el.textContent = words === 0 ? '0 words | ××™×œ×™×' : `${words} words â€” need ${40-words} more | ×¢×•×“ ${40-words} ××™×œ×™×`;
  } else if (words <= 60) {
    el.className = 'word-count good';
    el.textContent = `${words} words âœ… Perfect! | ××•×©×œ×!`;
    el.style.animation = 'goodPulse 0.5s ease';
  } else {
    el.className = 'word-count high';
    el.textContent = `${words} words â€” ${words-60} too many | ×™×•×ª×¨ ××“×™ ××™×œ×™×`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHECK TEXT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const VERB_ERRORS = {
  'go':     { past: 'went',  msg: '"go" â†’ use past tense "went"' },
  'goes':   { past: 'went',  msg: '"goes" â†’ use past tense "went"' },
  'eat':    { past: 'ate',   msg: '"eat" â†’ use past tense "ate"' },
  'eats':   { past: 'ate',   msg: '"eats" â†’ use past tense "ate"' },
  'see':    { past: 'saw',   msg: '"see" â†’ use past tense "saw"' },
  'sees':   { past: 'saw',   msg: '"sees" â†’ use past tense "saw"' },
  'drink':  { past: 'drank', msg: '"drink" â†’ use past tense "drank"' },
  'drinks': { past: 'drank', msg: '"drinks" â†’ use past tense "drank"' },
  'sleep':  { past: 'slept', msg: '"sleep" â†’ use past tense "slept"' },
  'sleeps': { past: 'slept', msg: '"sleeps" â†’ use past tense "slept"' },
  'meet':   { past: 'met',   msg: '"meet" â†’ use past tense "met"' },
  'meets':  { past: 'met',   msg: '"meets" â†’ use past tense "met"' },
  'am':     { past: 'was',   msg: '"am" â†’ use past tense "was"' },
  'is':     { past: 'was',   msg: '"is" â†’ use past tense "was"' },
  'are':    { past: 'were',  msg: '"are" â†’ use past tense "were"' },
  'have':   { past: 'had',   msg: '"have" â†’ use past tense "had"' },
  'has':    { past: 'had',   msg: '"has" â†’ use past tense "had"' },
  'do':     { past: 'did',   msg: '"do" â†’ use past tense "did"' },
  'does':   { past: 'did',   msg: '"does" â†’ use past tense "did"' },
};

// Words that allow a base verb to follow (so we don't flag "didn't go" etc.)
const BASE_VERB_CONTEXT = new Set([
  "didn't","don't","doesn't","can","will","could","would","should",
  "to","let","make","help","not","never","also","just","always"
]);

function escapeHTML(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function checkWriting() {
  const raw = get('w-text').value;
  const panel = get('w-check-result');
  show('w-check-result');

  // Re-trigger entrance animation
  panel.style.animation = 'none'; void panel.offsetWidth; panel.style.animation = '';

  if (!raw.trim()) {
    setHTML('w-check-result', `
      <div class="check-result-header">
        <span>ğŸ“‹ Check Results | ×ª×•×¦××•×ª ×‘×“×™×§×”</span>
        <button class="check-close-btn" onclick="hide('w-check-result')">âœ•</button>
      </div>
      <div class="no-errors" style="color:var(--muted); font-size:15px;">
        âœï¸ Write something first! | ×§×•×“× ×›×ª×‘×• ××©×”×•!
      </div>`);
    return;
  }

  const errors = [];
  let annotatedHTML = '';

  // Tokenize: split into words vs non-word runs
  const tokens = raw.match(/[a-zA-Z']+|[^a-zA-Z']+/g) || [];
  let atSentenceStart = true;
  let prevWord = '';

  tokens.forEach(token => {
    const isWord = /^[a-zA-Z']/.test(token);

    if (isWord) {
      const clean = token.toLowerCase();
      let cls = null, title = null;

      // Check: lowercase "i" used as personal pronoun
      if (clean === 'i' && token !== 'I') {
        cls   = 'err-capital';
        title = '"i" must always be capital "I" | "I" ×ª××™×“ ×‘××•×ª ×’×“×•×œ×”';
        errors.push({ type:'capital', icon:'ğŸ” ', msg: '"i" â†’ always write capital "I" | ×›×ª×‘×• "I" ×‘××•×ª ×’×“×•×œ×” ×ª××™×“' });
      }
      // Check: sentence starts with lowercase
      else if (atSentenceStart && /^[a-z]/.test(token)) {
        cls   = 'err-capital';
        title = 'Start the sentence with a capital letter | ×”×ª×—×™×œ×• ××ª ×”××©×¤×˜ ×‘××•×ª ×’×“×•×œ×”';
        errors.push({ type:'capital', icon:'ğŸ” ', msg: `"${token}" â€” sentences must start with a capital letter | ××©×¤×˜×™× ××ª×—×™×œ×™× ×‘××•×ª ×’×“×•×œ×”` });
      }
      // Check: present-tense verb (not after a skip-word)
      else if (VERB_ERRORS[clean] && !BASE_VERB_CONTEXT.has(prevWord)) {
        const e = VERB_ERRORS[clean];
        cls   = 'err-verb';
        title = e.msg + ' | ×©× ×• ×œ×–××Ÿ ×¢×‘×¨';
        errors.push({ type:'verb', icon:'âª', msg: e.msg + ' | ×©× ×• ×œ×–××Ÿ ×¢×‘×¨' });
      }

      annotatedHTML += cls
        ? `<span class="${cls}" title="${title}">${escapeHTML(token)}</span>`
        : escapeHTML(token);

      atSentenceStart = false;
      prevWord = clean;

    } else {
      // Reset sentence-start flag after . ? !
      if (/[.!?]/.test(token))  { atSentenceStart = true; prevWord = ''; }
      if (/\n/.test(token))      { atSentenceStart = true; prevWord = ''; }
      annotatedHTML += escapeHTML(token);
    }
  });

  // Check: text doesn't end with punctuation
  const lastChar = raw.trim().slice(-1);
  if (!/[.!?]/.test(lastChar)) {
    errors.push({ type:'punct', icon:'ğŸ“', msg: 'Add punctuation at the end of your text (. or ! or ?) | ×”×•×¡×™×¤×• ×¡×™××Ÿ ×¤×™×¡×•×§ ×‘×¡×•×£ (. ××• ! ××• ?)' });
  }

  // Build legend
  const hasVerb    = errors.some(e => e.type === 'verb');
  const hasCapital = errors.some(e => e.type === 'capital');
  const hasPunct   = errors.some(e => e.type === 'punct');
  const legendHTML = (hasVerb || hasCapital || hasPunct) ? `
    <div class="check-legend">
      <span style="font-weight:700; color:var(--muted); font-size:11px; text-transform:uppercase; letter-spacing:.5px;">Legend:</span>
      ${hasVerb    ? '<span class="legend-chip"><span class="err-verb"   style="font-size:12px;">word</span> Wrong tense | ×–××Ÿ ×œ× × ×›×•×Ÿ</span>' : ''}
      ${hasCapital ? '<span class="legend-chip"><span class="err-capital" style="font-size:12px;">word</span> Capital letter | ××•×ª ×’×“×•×œ×”</span>' : ''}
      ${hasPunct   ? '<span class="legend-chip"><span class="err-punct"   style="font-size:12px;">word</span> Punctuation | ×¤×™×¡×•×§</span>' : ''}
    </div>` : '';

  // Build error list (deduplicated)
  let errListHTML = '';
  if (!errors.length) {
    errListHTML = `<div class="no-errors">ğŸ‰ No errors found! Great job! | ×¢×‘×•×“×” ××¦×•×™× ×ª! ×œ× × ××¦××• ×©×’×™××•×ª!</div>`;
  } else {
    const seen = new Set();
    const unique = errors.filter(e => seen.has(e.msg) ? false : seen.add(e.msg));
    errListHTML = `<div class="err-list">
      <div style="font-size:12px; font-weight:700; color:var(--muted); margin-bottom:10px; text-transform:uppercase; letter-spacing:.5px;">
        ${errors.length} issue${errors.length !== 1 ? 's' : ''} found | × ××¦××• ${errors.length} ×‘×¢×™×•×ª
      </div>
      ${unique.map(e => `<div class="err-item ${e.type}">${e.icon} ${e.msg}</div>`).join('')}
    </div>`;
  }

  setHTML('w-check-result', `
    <div class="check-result-header">
      <span>ğŸ“‹ Check Results | ×ª×•×¦××•×ª ×‘×“×™×§×”</span>
      <button class="check-close-btn" onclick="hide('w-check-result')">âœ•</button>
    </div>
    ${legendHTML}
    <div class="annotated-box">${annotatedHTML}</div>
    ${errListHTML}
  `);

  panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
goHome();
</script>
</body>
</html>
